setv game "canopyctmp" addm 4952 4551 952 600 "COH"
* mmsc 5428 4851 "canopy.mng\\Cave"
setv va00 addr game "canopyctmp" 4989 5004 4951 4931 4980 5012
rtyp va00 0
rmsc 4996 4981 ""
setv game "canopyctmp_0" va00
setv va00 addr game "canopyctmp" 5004 5038 4931 4893 5012 5036
rtyp va00 0
rmsc 5021 4983 ""
setv game "canopyctmp_1" va00
setv va00 addr game "canopyctmp" 5038 5121 4986 4986 5036 5062
rtyp va00 6
rmsc 5079 5024 ""
setv game "canopyctmp_2" va00
setv va00 addr game "canopyctmp" 5121 5242 4986 4986 5062 5063
rtyp va00 6
rmsc 5181 5024 ""
setv game "canopyctmp_3" va00
setv va00 addr game "canopyctmp" 5242 5355 4986 4986 5063 5062
rtyp va00 6
rmsc 5298 5024 ""
setv game "canopyctmp_4" va00
setv va00 addr game "canopyctmp" 5355 5462 4986 4986 5062 5053
rtyp va00 6
rmsc 5408 5019 ""
setv game "canopyctmp_5" va00
setv va00 addr game "canopyctmp" 5591 5636 5047 5047 5053 5073
rtyp va00 8
rmsc 5613 5060 ""
setv game "canopyctmp_6" va00
setv va00 addr game "canopyctmp" 5038 5121 4893 4870 4986 4986
rtyp va00 0
rmsc 5079 4939 ""
setv game "canopyctmp_7" va00
setv va00 addr game "canopyctmp" 5121 5334 4870 4871 4986 4986
rtyp va00 0
rmsc 5227 4928 ""
setv game "canopyctmp_8" va00
setv va00 addr game "canopyctmp" 5334 5462 4871 4870 4986 4986
rtyp va00 0
rmsc 5398 4928 ""
setv game "canopyctmp_9" va00
setv va00 addr game "canopyctmp" 5462 5532 4870 4862 4986 4986
rtyp va00 0
rmsc 5497 4928 ""
setv game "canopyctmp_10" va00
setv va00 addr game "canopyctmp" 5636 5685 5047 5047 5073 5094
rtyp va00 8
rmsc 5660 5070 ""
setv game "canopyctmp_11" va00
setv va00 addr game "canopyctmp" 5685 5715 5047 5047 5094 5100
rtyp va00 8
rmsc 5700 5073 ""
setv game "canopyctmp_12" va00
setv va00 addr game "canopyctmp" 5715 5789 5047 5047 5100 5089
rtyp va00 8
rmsc 5752 5068 ""
setv game "canopyctmp_13" va00
setv va00 addr game "canopyctmp" 5789 5837 5047 5047 5089 5053
rtyp va00 8
rmsc 5813 5050 ""
setv game "canopyctmp_14" va00
setv va00 addr game "canopyctmp" 5789 5837 4766 4890 5047 5047
rtyp va00 0
rmsc 5813 4906 ""
setv game "canopyctmp_15" va00
setv va00 addr game "canopyctmp" 5837 5855 4890 4964 5053 5020
rtyp va00 0
rmsc 5846 4955 ""
setv game "canopyctmp_16" va00
setv va00 addr game "canopyctmp" 5740 5789 4672 4766 5047 5047
rtyp va00 0
rmsc 5764 4859 ""
setv game "canopyctmp_17" va00
setv va00 addr game "canopyctmp" 5691 5740 4616 4672 5047 5047
rtyp va00 0
rmsc 5715 4831 ""
setv game "canopyctmp_18" va00
setv va00 addr game "canopyctmp" 5613 5691 4616 4616 5047 5047
rtyp va00 0
rmsc 5652 4831 ""
setv game "canopyctmp_19" va00
setv va00 addr game "canopyctmp" 5462 5591 4986 4986 5053 5053
rtyp va00 6
rmsc 5526 5019 ""
setv game "canopyctmp_20" va00
setv va00 addr game "canopyctmp" 5591 5613 4615 4616 5047 5047
rtyp va00 0
rmsc 5602 4831 ""
setv game "canopyctmp_21" va00
setv va00 addr game "canopyctmp" 5532 5591 4612 4615 4986 4986
rtyp va00 0
rmsc 5561 4799 ""
setv game "canopyctmp_22" va00
setv va00 addr game "canopyctmp" 5500 5532 4776 4776 4838 4841
rtyp va00 6
rmsc 5516 4808 ""
setv game "canopyctmp_23" va00
setv va00 addr game "canopyctmp" 5396 5500 4776 4776 4842 4838
rtyp va00 6
rmsc 5448 4807 ""
setv game "canopyctmp_24" va00
setv va00 addr game "canopyctmp" 5297 5396 4776 4776 4842 4842
rtyp va00 6
rmsc 5346 4809 ""
setv game "canopyctmp_25" va00
setv va00 addr game "canopyctmp" 5250 5297 4776 4776 4841 4842
rtyp va00 6
rmsc 5273 4809 ""
setv game "canopyctmp_26" va00
setv va00 addr game "canopyctmp" 5184 5250 4776 4776 4830 4841
rtyp va00 6
rmsc 5217 4808 ""
setv game "canopyctmp_27" va00
setv va00 addr game "canopyctmp" 5109 5184 4776 4776 4807 4830
rtyp va00 6
rmsc 5146 4803 ""
setv game "canopyctmp_28" va00
setv va00 addr game "canopyctmp" 5083 5109 4776 4776 4785 4807
rtyp va00 6
rmsc 5096 4791 ""
setv game "canopyctmp_29" va00
setv va00 addr game "canopyctmp" 5069 5083 4716 4685 4755 4785
rtyp va00 0
rmsc 5076 4750 ""
setv game "canopyctmp_30" va00
setv va00 addr game "canopyctmp" 5410 5532 4612 4612 4776 4776
rtyp va00 0
rmsc 5471 4694 ""
setv game "canopyctmp_31" va00
setv va00 addr game "canopyctmp" 5304 5410 4613 4612 4776 4776
rtyp va00 0
rmsc 5357 4694 ""
setv game "canopyctmp_32" va00
setv va00 addr game "canopyctmp" 5228 5304 4613 4613 4776 4776
rtyp va00 0
rmsc 5266 4694 ""
setv game "canopyctmp_33" va00
setv va00 addr game "canopyctmp" 5148 5228 4625 4613 4776 4776
rtyp va00 0
rmsc 5188 4700 ""
setv game "canopyctmp_34" va00
setv va00 addr game "canopyctmp" 5083 5148 4685 4625 4776 4776
rtyp va00 0
rmsc 5115 4730 ""
setv game "canopyctmp_35" va00

door game "canopyctmp_0" game "canopyctmp_1" 100
door game "canopyctmp_1" game "canopyctmp_2" 100
door game "canopyctmp_1" game "canopyctmp_7" 100
door game "canopyctmp_2" game "canopyctmp_3" 100
door game "canopyctmp_2" game "canopyctmp_7" 100
door game "canopyctmp_3" game "canopyctmp_4" 100
door game "canopyctmp_3" game "canopyctmp_8" 100
door game "canopyctmp_4" game "canopyctmp_5" 100
door game "canopyctmp_4" game "canopyctmp_8" 100
door game "canopyctmp_4" game "canopyctmp_9" 100

door game "canopyctmp_5" game "canopyctmp_9" 100
door game "canopyctmp_5" game "canopyctmp_20" 100
door game "canopyctmp_6" game "canopyctmp_11" 100
door game "canopyctmp_6" game "canopyctmp_19" 100
door game "canopyctmp_6" game "canopyctmp_20" 100
door game "canopyctmp_6" game "canopyctmp_21" 100
door game "canopyctmp_7" game "canopyctmp_8" 100
door game "canopyctmp_8" game "canopyctmp_9" 100
door game "canopyctmp_9" game "canopyctmp_10" 100
door game "canopyctmp_10" game "canopyctmp_20" 100

door game "canopyctmp_10" game "canopyctmp_22" 100
door game "canopyctmp_11" game "canopyctmp_12" 100
door game "canopyctmp_11" game "canopyctmp_19" 100
door game "canopyctmp_12" game "canopyctmp_13" 100
door game "canopyctmp_12" game "canopyctmp_18" 100
door game "canopyctmp_12" game "canopyctmp_19" 100
door game "canopyctmp_13" game "canopyctmp_14" 100
door game "canopyctmp_13" game "canopyctmp_17" 100
door game "canopyctmp_13" game "canopyctmp_18" 100
door game "canopyctmp_14" game "canopyctmp_15" 100

door game "canopyctmp_14" game "canopyctmp_16" 100
door game "canopyctmp_15" game "canopyctmp_16" 100
door game "canopyctmp_15" game "canopyctmp_17" 100
door game "canopyctmp_17" game "canopyctmp_18" 100
door game "canopyctmp_18" game "canopyctmp_19" 100
door game "canopyctmp_19" game "canopyctmp_21" 100
door game "canopyctmp_20" game "canopyctmp_21" 100
door game "canopyctmp_20" game "canopyctmp_22" 100
door game "canopyctmp_21" game "canopyctmp_22" 100
door game "canopyctmp_22" game "canopyctmp_23" 100

door game "canopyctmp_22" game "canopyctmp_31" 100
door game "canopyctmp_23" game "canopyctmp_24" 100
door game "canopyctmp_23" game "canopyctmp_31" 100
door game "canopyctmp_24" game "canopyctmp_25" 100
door game "canopyctmp_24" game "canopyctmp_31" 100
door game "canopyctmp_24" game "canopyctmp_32" 100
door game "canopyctmp_25" game "canopyctmp_26" 100
door game "canopyctmp_25" game "canopyctmp_32" 100
door game "canopyctmp_25" game "canopyctmp_33" 100
door game "canopyctmp_26" game "canopyctmp_27" 100

door game "canopyctmp_26" game "canopyctmp_33" 100
door game "canopyctmp_27" game "canopyctmp_28" 100
door game "canopyctmp_27" game "canopyctmp_33" 100
door game "canopyctmp_27" game "canopyctmp_34" 100
door game "canopyctmp_28" game "canopyctmp_29" 100
door game "canopyctmp_28" game "canopyctmp_34" 100
door game "canopyctmp_28" game "canopyctmp_35" 100
door game "canopyctmp_29" game "canopyctmp_30" 100
door game "canopyctmp_29" game "canopyctmp_35" 100
door game "canopyctmp_30" game "canopyctmp_35" 100

door game "canopyctmp_31" game "canopyctmp_32" 100
door game "canopyctmp_32" game "canopyctmp_33" 100
door game "canopyctmp_33" game "canopyctmp_34" 100
door game "canopyctmp_34" game "canopyctmp_35" 100

delg "canopyctmp_0"
delg "canopyctmp_1"
delg "canopyctmp_2"
delg "canopyctmp_3"
delg "canopyctmp_4"
delg "canopyctmp_5"
delg "canopyctmp_6"
delg "canopyctmp_7"
delg "canopyctmp_8"
delg "canopyctmp_9"
delg "canopyctmp_10"
delg "canopyctmp_11"
delg "canopyctmp_12"
delg "canopyctmp_13"
delg "canopyctmp_14"
delg "canopyctmp_15"
delg "canopyctmp_16"
delg "canopyctmp_17"
delg "canopyctmp_18"
delg "canopyctmp_19"
delg "canopyctmp_20"
delg "canopyctmp_21"
delg "canopyctmp_22"
delg "canopyctmp_23"
delg "canopyctmp_24"
delg "canopyctmp_25"
delg "canopyctmp_26"
delg "canopyctmp_27"
delg "canopyctmp_28"
delg "canopyctmp_29"
delg "canopyctmp_30"
delg "canopyctmp_31"
delg "canopyctmp_32"
delg "canopyctmp_33"
delg "canopyctmp_34"
delg "canopyctmp_35"

new: simp 1 3 4180 "fav_place_bugtemple" 1 0 1
attr 272 mvto 5780 4630 tick 10 cmrt 0


******************
* Cave Outside Door *
******************
new: simp 1 1 4186 "ze_mushroom_door" 7 7 0
tick 0
attr 0
bhvr 0
fric 0
elas 0
accg 0
mvto 500 20700
* The Actual Door!
new: simp 2 2 4182 "ze_mushroom_door" 8 0 1
tick 0
attr 4
bhvr 1
fric 0
elas 0
accg 0
tint 120 100 90 128 128
seta va08 targ
mvto 500 20700

new: simp 2 2 4183 "ze_mushroom_door" 1 8 1
tick 0
attr 4
bhvr 1
fric 0
elas 0
accg 0
seta ov00 va08
seta avar va08 0 targ
mvto 4952 4855


**Doors
scrp 2 2 4182 1
	lock
*	check who gave signal
		targ from
*	check if its the pointer
		doif targ eq pntr
*		flag metaroom change
			setv mv99 1
		else
*		flag norn
			setv mv99 0
		endi
		targ ownr
		anim [0 1 2 3 4 5 6]
		wait 2
		loop
			doif posl <= 500
				velo 3 0
			endi
		untl posl >= 530
		velo 0 0
		doif mv99 = 0
			doif from ne null
				targ from
				mvsf 5230 4990
			endi
		endi
		enum 2 2 4183
			setv va00 0
			loop
				addv va00 5
				alph va00 1
			untl va00 >= 255
			doif mv99 = 1
				cmrt 0

				etch 4 0 0
					mvsf 5230 4990
				next
				targ ownr
				targ ov00

			endi
			setv va00 255
			loop
				subv va00 5
				alph va00 1
			untl va00 <= 0
		next
		anim [6 5 4 3 2 1 0]
		wait 2
		loop
			doif posl >= 530
				velo -3 0
			endi
		untl posl <= 500
		velo 0 0
	unlk
endm

scrp 2 2 4183 1
	lock
*	check who gave signal
	targ from
*	check if its the pointer
	doif targ eq pntr
*		flag metaroom change
		setv mv99 1
	else
*		flag norn
		setv mv99 0
	endi
	targ ownr

	setv va00 0
	loop
		addv va00 5
		alph va00 1
	untl va00 >= 255
	doif mv99 = 0
		doif from ne null
			targ from
			mvsf 530 20720
		endi
	endi
	enum 2 2 4182
		anim [0 0 1 1 2 2 3 3 4 4 5 5 6 6]
		wait 2
		loop
			doif posl <= 500
				velo 2 0
			endi
		untl posl >= 530
		velo 0 0
		doif mv99 = 1
			cmrt 0

			etch 4 0 0
				mvsf 530 20720
			next
			targ ownr
			targ ov00

		endi
		anim [6 6 5 5 4 4 3 3 2 2 1 1 0 0]
		wait 2
		loop
			doif posl >= 530
				velo -2 0
			endi
		untl posl <= 500
		velo 0 0
	next
	setv va00 255
	loop
		subv va00 5
		alph va00 1
	untl va00 <= 0
	unlk
endm




****************
* Top - Bottom *
****************


* Top Teleport
new: simp 2 2 4185 "canopy_mover" 3 16 800
bhvr 1
attr 198
accg 3
elas 5
fric 80
perm 60
seta va00 targ
setv ov02 0
mvsf 5118 4770

* Bottom Teleport
new: simp 2 2 4185 "canopy_teleporter" 1 0 30
bhvr 1
attr 4
accg 6
elas 2
tint 90 95 90 128 128
seta ov00 va00
seta avar va00 0 targ
setv ov02 1
mvto 5281 4971


**Doors
scrp 2 2 4185 1
	lock

*Tell the norn on the other end to wait
	doif crea from = 1
		stim writ from 75 1
	endi

	doif ov02 = 0
		anim [0 1 0]
	endi

	targ ov00
	setv va00 posx
	setv va01 posb

	doif ov02 = 0
		anim [0 1 0]
	endi

	targ ownr
	doif from = pntr
		targ ov00
		cmrt 0

		etch 4 0 0
			doif carr eq null and movs = 0
				doif hhld ne targ
*					nohh
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		next
	else
		doif from ne null
			targ from
			doif hhld ne targ
*				nohh
				doif carr eq null and movs = 0
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		endi
	endi
	targ ownr

	unlk	
endm


******************
* Crystal Ball   *
******************

setv va10 0
reps 2
	new: comp 2 2 4186 "canopy_teleporter" 3 3 40
	attr 198
	bhvr 1
	accg 4
	elas 50
	alph 50 1
	rnge 20
	tick 1
	setv velx rand -5 5
	
	doif va10 eq 1
		seta ov00 va00
		seta avar va00 0 targ
	endi
	seta va00 targ
	setv ov02 va10

	mvsf 5581 4918

	addv va10 1
repe

* Top
	new: simp 2 21 4186 "c1top" 0 0 5000
	attr 199
	bhvr 41
	accg 5
	elas 0
	fric 90
	aero 10
	perm 70
*	tick 1
	pose 0
	setv ov99 0
	setv ov98 180
	addv ov91 5
	mvsf 700 9200
	setv ov90 posl
	setv ov91 post

	seta ov00 va00
	seta avar va00 0 targ

************************

scrp 2 2 4186 1
	lock

*Tell the norn on the other end to wait
	doif crea from = 1
		stim writ from 75 1
	endi

	anim [0 1 0]

	targ ov00
	setv va00 posx
	setv va01 posb

	doif ov02 = 1
		anim [0 1 0]
	endi

	targ ownr
	doif from = pntr
		targ ov00
		cmrt 0

		etch 4 0 0
			doif carr eq null and movs = 0
				doif hhld ne targ
*					nohh
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		next
	else
		doif from ne null
			targ from
			doif hhld ne targ
*				nohh
				doif carr eq null and movs = 0
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		endi
	endi
	targ ownr

	unlk	
endm

*******************************




scrp 2 21 4186 1
*	top is pushed
	doif ov99 = 0
		tick 1
		setv ov97 0
		setv ov99 1
*		sndc "c1to"
		stim writ from 97 1
	endi

	lock

	targ ownr

*Tell the norn on the other end to wait
	doif crea from = 1
		stim writ from 75 1
	endi

	targ ov00
	setv va00 posx
	setv va01 posb

	anim [0 1 0]

	targ ownr
	doif from = pntr
		targ ov00
		cmrt 0

		etch 4 0 0
			doif carr eq null and movs = 0
				doif hhld ne targ
*					nohh
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		next
	else
		doif from ne null
			targ from
			doif hhld ne targ
*				nohh
				doif carr eq null and movs = 0
					mvsf va00 va01
					stim writ from 95 1
				endi
			endi
		endi
	endi
	targ ownr

	unlk	

endm

scrp 2 21 4186 4
*	top picked up
	setv ov99 0
	stpc
	pose 0
endm

scrp 2 21 4186 6
*	top collides
	setv ov99 0
	stpc
	pose 0
endm


scrp 2 21 4186 9
*	top timer
	inst
	doif ov99 = 0
		tick 0
		stpc
		pose 0
		doif movs = 0
			mvsf ov90 ov91
		endi
	else
		doif ov97 = 0
			anim [0 1 2 3 4 5 6 7 255]
			setv ov90 posl
			setv ov91 post
			addv ov91 5
			addv ov97 1
		elif ov97 > 0 and ov97 < 120
			setv va00 ov90
			setv va10 sin_ ov98
			mulv va10 40
			addv va00 va10
			addv ov98 7.5
			doif ov98 >= 360
				setv ov98 0
			endi
			setv va11 va10
			absv va11
			doif va10 < 0 and obst left >= va11
				setv va00 ov90
				setv va01 post
				addv va01 5
				addv va00 va10
			elif va10 > 0 and obst rght >= va11
				setv va00 ov90
				setv va01 post
				addv va01 5
				addv va00 va10
			else
				setv va00 posl
				setv va01 post
				addv va01 5
			endi
			doif movs = 0 and carr = null
				mvsf va00 va01
			endi
			addv ov97 1
		else
			setv ov99 0
		endi
	endi
endm