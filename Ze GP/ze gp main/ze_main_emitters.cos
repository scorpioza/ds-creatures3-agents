*Heat

setv va00 0

new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.5
mvto 21704	1556

new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 2.0
mvto 22084	1556

new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.5
mvto 22404	1556


* Top Bridge 

* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21774 856

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21774 856

* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22470 856

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 22470 856


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 20840 1730

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 20840 1730


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21338 1730

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21338 1730

* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 20840 1400

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 20840 1400

* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21338 1400

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21338 1400


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21164 1111

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21164 1111


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22871 1077

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21164 1111



* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22950 1373

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 22950 1373


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22990 1818

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 22990 1818


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 20820 2222

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 20820 2222


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21300 2222

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21300 2222


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21808 2222

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21808 2222

* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22400 2222

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 22400 2222


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 22900 2222

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 22900 2222


* Heat
new: simp 1 1 30128 "blnk" 1 va00 8000
attr 16
clac 0
emit 2 1.0
mvto 21090 2772

* Light
new: simp 1 1 30128 "blnk" 1 0 0
attr 16
pose va00
emit 1 1.0
mvto 21090 2772


* =========================================


**CA Emitters
*Manager
new: simp 1 1 18886 "blank" 1 0 1
attr 16
tick 10
*tint 255 255 255 128 128
mvto 22090 1605

*Emitters
*Set va00 to 1 to make emitters visible
setv va00 0

*Light
new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 1
mvto 21763 1339

new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 1
mvto 22169 1339

new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 1
mvto 22515 1339

*Heat
new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 2
mvto 21810 1449

new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 2
mvto 22438 1456

*Bodies of Water
new: simp 1 1 18887 "blnk" 1 va00 1
attr 16
setv ov00 5
mvto 21592 2027

*Waterspout
new: simp 1 1 18888 "blnk" 1 va00 1
attr 16
tick 150
mvto 22344 1785

*Waterfall
new: simp 1 1 18785 "blnk" 1 0 1
attr 16
tick 1
*ov00 = season variable
setv ov00 0
mvto 22066	1315


* =========================================


**CA Emitters
*Manager
scrp 1 1 18886 9
*Set constants - va00 is light, va01 is heat
	setv va00 2.0
*Heat is lower than light since it's not going to be very high anyway thanks to the waterfall
	setv va01 3.0

*Dawn - Both are at a third of their usual values
	doif time = 0
		divv va00 3
		divv va01 3
*Light gets set to its full value; heat is at half strength
	elif time = 1
		divv va01 2
*Afternoon - both are at full strength, don't alter anything		
	elif time = 2
*Evening - light goes down to two-thirds, heat down to half again 
	elif time = 3
		mulv va00 2
		divv va00 3
		divv va01 2
*Night - both are at 1/4 strength
	elif time = 4
		divv va00 4
		divv va01 4
	endi

*Tell the light and heat to function
	enum 1 1 18887
		doif ov00 = 1
			mesg wrt+ targ 1000 va00 0 0
		elif ov00 = 2
			mesg wrt+ targ 1000 va01 0 0
		else
*This is a water smell emitter; it has a constant value
			mesg wrt+ targ 1000 0.5 0 0
		endi
	next
endm

*Exceptions - they happen, unfortunately
scrp 1 1 18886 255
	tick tick
endm

*Light and heat emitters
scrp 1 1 18887 1000
	emit ov00 _p1_
endm

*Waterspout and "water" - this is for the cave only
**The waterfall does the same purpose for the upper level
scrp 1 1 18888 9
	setv va00 posl
	setv va01 post
	inst
	reps rand 2 4
		new: simp 1 1 18889 "blnk" 1 0 6000
		attr 208
		accg 1
		aero 1
		perm 100
		elas 0
		fric 100
		tick 100
		mvto va00 va01
		velo rand -15 15 rand -2 2
	repe
	slow
	targ ownr
endm

scrp 1 1 18889 6
	inst
	doif room ownr <> -1
		altr room ownr 3 0.3
		altr room ownr 4 0.1
	endi
	kill ownr
	slow
endm

scrp 1 1 18889 9
	doif room ownr <> -1
		altr room ownr 3 0.1
		altr room ownr 4 0.05
	endi
	kill ownr
endm

**Waterfall and Droplets
scrp 1 1 18785 9
*Season variables
*Spring
	doif sean = 0
		setv ov00 rand 3 6
*Summer
	elif sean = 1
		setv ov00 rand 1 2
*Autumn
	elif sean = 2
		setv ov00 rand 2 4
*Winter
	elif sean = 3
		setv ov00 1
	endi

*If the countdown is 0, create a water droplet
	setv va00 21942
	setv va01 22192
	setv va02 1369
	inst
	reps ov00
		new: simp 2 19 18785 "waterfall_droplet" 5 0 500
		attr 192
		accg rand 1 5
		aero 0
		perm 100
		elas 0
		fric 100
		tick 1
		alph rand 100 200 1
		mvsf rand va00 va01 va02
	repe
endm

*Droplet scripts
scrp 2 19 18785 9
*Kill the droplet if not splashed correctly
	doif rtyp grap posx posb = 8 or rtyp grap posx posb = 9 or vely = 0
		doif room ownr <> -1
			altr room targ 2 -0.01
			altr room targ 3 0.05
			altr room targ 4 0.01
		endi
		kill ownr
	endi
endm

*Collision script
scrp 2 19 18785 6
	doif wall = down
		anim [0 1 2 3 4]
		doif room ownr <> -1
			altr room targ 2 -0.01
			altr room targ 3 0.05
			altr room targ 4 0.01
		endi
		over
		kill ownr
	endi
endm